<html>
	<head>
		<title>Solar System - WebGL</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name='apple-mobile-web-app-capable' content='yes'/>
		<meta name='apple-mobile-web-app-status-bar-style' content='black-translucent'/>
		
		<link rel='stylesheet' href='themes/base/jquery.ui.all.css'></link>

		<script type='text/javascript' src='/js/jquery-1.10.0.min.js'></script>
		
		<script src='ui/jquery.ui.widget.js'></script>
		<script src='ui/jquery.ui.mouse.js'></script>
		<script src='ui/jquery.ui.slider.js'></script>
		
		<script type='text/javascript' src='/js/gl-matrix.2.2.0.min.js'></script>
		<script type='text/javascript'>
glMatrix.setMatrixArrayType(Array);
		</script>
		<script type='text/javascript' src='/js/webgl-debug.js'></script>
		<script type='text/javascript' src='/js/util.js'></script>
		<script type='text/javascript' src='/js/gl-util.js'></script>
		<script type='text/javascript' src='/js/gl-util-gradient.js'></script>
		<script type='text/javascript' src='/js/mouse3d.js'></script>
		<script type='text/javascript' src='/js/integrate.js'></script>
		
		<script type='text/javascript' src='astro-api.js'></script>
		<script type='text/javascript' src='horizons/full-horizons-results.json'></script>
		<script type='text/javascript' src='horizons/full-horizons-extra-data.json'></script>

		<script type='text/javascript' src='main.js'></script>
		
		<script type='text/javascript'>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-17312646-1']);
_gaq.push(['_trackPageview']);
(function() {
	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
		</script>

<!-- maximizing depth range: http://outerra.blogspot.com/2012/11/maximizing-depth-buffer-range-and.html -->

		<script id='color-vsh' type='x-shader/x-vertex'>
attribute vec3 vertex;
uniform mat4 mvMat;
uniform mat4 projMat;
uniform float zNear, zFar, depthConstant;
void main() {
	vec4 vtx4 = mvMat * vec4(vertex, 1.);
	gl_Position = projMat * vtx4;
	gl_PointSize = 4.;
	//gl_Position.z = (log(gl_Position.w + 1.) * depthConstant - 1.) * gl_Position.w;
	//gl_Position.z = (2.0 * log(gl_Position.w / zNear) / log(zFar / zNear) - 1.) * gl_Position.w; 
}
		</script>
		<script id='color-fsh' type='x-shader/x-fragment'>
uniform vec4 color;
void main() {
	gl_FragColor = color;
}
		</script>
		
		<script id='orbit-vsh' type='x-shader/x-vertex'>
attribute vec4 vertex;
varying float alpha;
uniform mat4 mvMat;
uniform mat4 projMat;
uniform float zNear, zFar, depthConstant;
void main() {
	vec4 vtx4 = mvMat * vec4(vertex.xyz, 1.);
	alpha = vertex.w;
	gl_Position = projMat * vtx4;
	gl_PointSize = 4.;
	//gl_Position.z = (log(gl_Position.w + 1.) * depthConstant - 1.) * gl_Position.w;
	//gl_Position.z = (2.0 * log(gl_Position.w / zNear) / log(zFar / zNear) - 1.) * gl_Position.w; 
}
		</script>
		<script id='orbit-fsh' type='x-shader/x-fragment'>
uniform vec4 color;
varying float alpha;
void main() {
	gl_FragColor = vec4(color.xyz, color.w * alpha);
}
		</script>

		<script id='ring-vsh' type='x-shader/x-vertex'>
#define M_PI 3.1415926535897931 
attribute vec2 vertex;
uniform mat4 mvMat;
uniform mat4 projMat;
uniform float minRadius;
uniform float maxRadius;
varying vec2 texCoordv;
uniform float zNear, zFar, depthConstant;
void main() {
	texCoordv = vertex;
	//vertex is the uv of the texcoord wrapped around the annulus 
	//u coord is radial, v coord is angular 
	float rad = mix(minRadius, maxRadius, vertex.x);
	float theta = 2. * M_PI * vertex.y;
	float cosTheta = cos(theta);
	float sinTheta = sin(theta);
	vec4 vtx4 = mvMat * vec4(cosTheta * rad, sinTheta * rad, 0., 1.);
	gl_Position = projMat * vtx4;
	//gl_Position.z = (log(gl_Position.w + 1.) * depthConstant - 1.) * gl_Position.w;
	//gl_Position.z = (2.0 * log(gl_Position.w / zNear) / log(zFar / zNear) - 1.) * gl_Position.w; 
}
		</script>
		<script id='ring-fsh' type='x-shader/x-fragment'>
varying vec2 texCoordv;
uniform sampler2D tex;
void main() {
	gl_FragColor = texture2D(tex, texCoordv);
}
		</script>


		<script id='tex-vsh' type='x-shader/x-vertex'>
attribute vec3 vertex;
attribute vec2 texCoord;
varying vec2 texCoordv;
uniform mat4 mvMat;
uniform mat4 projMat;
uniform float zNear, zFar, depthConstant;
void main() {
	texCoordv = texCoord;
	vec4 vtx4 = mvMat * vec4(vertex, 1.);
	gl_Position = projMat * vtx4;
	//gl_Position.z = (log(gl_Position.w + 1.) * depthConstant - 1.) * gl_Position.w;
	//gl_Position.z = (2.0 * log(gl_Position.w / zNear) / log(zFar / zNear) - 1.) * gl_Position.w; 
}
		</script>
		<script id='tex-fsh' type='x-shader/x-fragment'>
varying vec2 texCoordv;
uniform sampler2D tex;
void main() {
	gl_FragColor = texture2D(tex, texCoordv);
}
		</script>
		
		<script id='heat-vsh' type='x-shader/x-vertex'>
attribute vec3 vertex;
attribute vec2 texCoord;
attribute float tide;
uniform mat4 mvMat;
uniform mat4 projMat;
varying float tidev;
varying vec2 texCoordv;
uniform float zNear, zFar, depthConstant;
void main() {
	tidev = tide;
	texCoordv = texCoord;
	vec4 vtx4 = mvMat * vec4(vertex, 1.);
	gl_Position = projMat * vtx4;
	//gl_Position.z = (log(gl_Position.w + 1.) * depthConstant - 1.) * gl_Position.w;
	//gl_Position.z = (2.0 * log(gl_Position.w / zNear) / log(zFar / zNear) - 1.) * gl_Position.w; 
}
		</script>
		<script id='heat-fsh' type='x-shader/x-fragment'>
varying float tidev;
varying vec2 texCoordv;
uniform sampler2D tex;
uniform sampler2D hsvTex;
uniform float heatAlpha;
void main() {
	vec4 hsvColor = texture2D(hsvTex, vec2(tidev, .5));
	vec4 planetColor = texture2D(tex, texCoordv);
	gl_FragColor = mix(planetColor, hsvColor, heatAlpha);
}
		</script>
		<script id='perpixel-heat-vsh' type='x-shader/x-vertex'>
//will be used by all per-pixel shaders
attribute vec3 vertex;
attribute vec2 texCoord;
uniform mat4 mvMat;
uniform mat4 objMat;
uniform mat4 projMat;
varying vec2 texCoordv;
varying vec4 worldv;
uniform float zNear, zFar, depthConstant;
void main() {
	tidev = tide;
	texCoordv = texCoord;
	worldv = objMat * vec4(vertex, 1.);
	gl_Position = projMat * mvMat * worldv;
	//gl_Position.z = (log(gl_Position.w + 1.) * depthConstant - 1.) * gl_Position.w;
	//gl_Position.z = (2.0 * log(gl_Position.w / zNear) / log(zFar / zNear) - 1.) * gl_Position.w; 
}
		</script>
		<script id='tangent-tidal-fsh' type='x-shader/x-fragment'>
varying vec2 texCoordv;
varying vec4 worldv;
uniform float heatAlpha;
uniform sampler2D tex;
uniform sampler2D hsvTex;
void main() {
	float tidev = something(worldv);	//do calculations with this.  fix it if the precision isn't good enough.
	vec4 hsvColor = texture2D(hsvTex, vec2(tidev, .5));
	vec4 planetColor = texture2D(tex, texCoordv);
	gl_FragColor = mix(planetColor, hsvColor, heatAlpha);
}
		</script>
		<script id='cube-vsh' type='x-shader/x-vertex'>
attribute vec3 vertex;
varying vec3 vertexv;
uniform mat4 projMat;

void main() {
	vertexv = vertex;
	gl_Position = projMat * vec4(vertex, 1.);
}
		</script>
		<script id='cube-fsh' type='x-shader/x-fragment'>
precision mediump float;
varying vec3 vertexv;
uniform samplerCube skyTex;

uniform vec4 viewAngle;
vec3 qtransform( vec4 q, vec3 v ){ 
	return v + 2.0*cross(cross(v, q.xyz ) + q.w*v, q.xyz);
}
void main() {
	vec3 dir = vertexv;
	dir = qtransform(vec4(viewAngle.xyz, -viewAngle.w), dir);
	gl_FragColor = .3 * textureCube(skyTex, dir);
	gl_FragColor.w = 1.; 
}
		</script>



		<style type='text/css'>

body {
	background-color:black;
	color:white;
}

a:link {
	cursor:pointer;
	color:#00FFFF;
}

a:visited {
	cursor:pointer;
	color:#00FFFF;
}

a:hover {
	cursor:pointer;
	color:#00FFFF;
}

a:active {
	cursor:pointer;
	color:#00FFFF;
}
		</style>
	
	</head>
	<body style='margin:0px; overflow:hidden'>
		<div id='timeControlDiv' style='padding:5px; z-index:1; position:absolute; top:0px; right:0px; display:none'>
			<img id='reset' src='reset.png' style='padding:5px'/>
			<img id='rewind' src='rewind.png' style='padding:5px'/>
			<img id='reverse' src='reverse.png' style='padding:5px'/>
			<img id='pause' src='stop.png' style='padding:5px'/>
			<img id='play' src='play.png' style='padding:5px'/>
			<img id='ffwd' src='ffwd.png' style='padding:5px'/>
		</div>

		<div id='infoDiv' style='padding:5px; z-index:1; position:absolute; bottom:0px; right:64px; display:none'>
			<span id='hoverPlanetText'></span><br>
			<span id='currentTimeText'></span><br>
		</div>
	
		<div id='panel' style='overflow-x:hidden; z-index:1; max-width:300px; position:absolute; background-color:rgba(0,0,0,.75)'>		
			<div id='loadingDiv' style='padding:5px'>Loading... 
				<progress id='loading' value='0' max='100'></progress><br>
			</div>
			<img id='menu' src='menu.png' style='padding:5px; display:none'/><br>
			
			<br>
			<div id='content' style='display:none'>
				Orbitting: <span id='orbitPlanetText'></span><br>
				<br>
				Distance: <span id='orbitTargetDistance'></span><br>
				<br>
				<span style='color:rgb(127,127,255)'>Min:</span> <span id='measureMin'></span><br>
				<span style='color:rgb(255,0,0)'>Max:</span> <span id='measureMax'></span><br>
				<br>
				Overlay:
				<div id='overlay-slider'></div><br>
				<input id='showLinesToOtherPlanets' type='checkbox'/>Show Lines to Other Planets<br>
				<input id='showLatAndLonLines' type='checkbox'/>Show Latitude and Longitude Lines<br>
				<input id='showGravityWell' type='checkbox'/>Show Gravity Wells<br>
				<div style='padding-left:10px'>
					<input id='gravityWellScaleNormalized' type='radio' name='gravityWellScale' checked='checked'/>Normalized Scale<br>
					<input id='gravityWellScaleFixed' type='radio' name='gravityWellScale'/>Fixed Scale
					<input id='gravityWellScaleFixedValue' value='2000'/>
				</div>
				<!-- too slow with moons -->
				<input id='showDistantPoints' type='checkbox'/>Show Points in Distance<br>
				<input id='showOrbits' type='checkbox'/>Show Orbits<br>
				<br>
				<span style='font-size:.8em'>Normal forces are negative when directed inwards (i.e. gravity) and positive when directed outwards.</span><br><br>
			</div>
		</div>
		<div id='webglfail' style='display:none'>
			Sorry, your browser does not support WebGL<br>
			Try one of these other, better browsers:<br>
			<a href='http://www.google.com/chrome'>Chrome</a><br>
			<a href='http://www.mozilla.org/firefox'>Firefox</a><br>
			<a href='http://www.apple.com/safari'>Safari</a><br>
			<b>Opera Users:</b><br>
			Enter "opera:config" in the address bar.<br>
			In the "User Prefs" section set both "Enable Hardware Acceleration" and "Enable WebGL" to "1" and then click "Save".<br>
			It is still buggy.<br>
			<b>IE Users:</b><br>
			Sorry guys, IE doesn't plan to support WebGL.<br>
			Consider using a more <a href='http://www.w3schools.com/browsers/browsers_stats.asp'>standard compliant</a> browser.<br>
			<br>
			<center>
				<a href='screenshot.png'>
					<img src='screenshot.png'></img>
				</a><br>
			</center>
		</div>
	</body>
</html>

